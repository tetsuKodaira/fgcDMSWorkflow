{"Columns":[{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"char","MaxLength":-1,"Name":"experiment_document_id","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"experiment_document_name","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"char","MaxLength":-1,"Name":"categoly_experiment_document_relation_id","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"int","MaxLength":-1,"Name":"progress_id","ColumnType":"System.Int32, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"}],"ExternalDatabaseInfo":{"SourceConnectString":"Data Source=ntvmd396;Initial Catalog=ExperimentDocumentManagementTest;Persist Security Info=True;User ID=z037674;Password=z037674","CreateViewSql":"--WFテーブルから最新進捗を取得\r\nWITH progress AS(\r\n\tSELECT\r\n\t\twf.experiment_document_id,\r\n\t\twf.categoly_wf_id,\r\n\t\twf_detail.wf_detail_approval_level,\r\n\t\twf_detail.categoly_wf_status_id,\r\n\t\twf_detail.wf_detail_approval_update_employee_z_code_next,\r\n\t\twf.wf_id, wf_detail.categoly_wf_status_id_next\r\n\tFROM \r\n\t\tdbo.edm_wfs AS wf\r\n\tINNER JOIN\r\n\t\t(SELECT\r\n\t\t\texperiment_document_id,\r\n\t\t\tMAX(categoly_wf_id) AS categoly_wf_id\r\n        FROM dbo.edm_wfs\r\n        GROUP BY experiment_document_id) AS wf_max\r\n\t\tON wf.experiment_document_id = wf_max.experiment_document_id AND wf.categoly_wf_id = wf_max.categoly_wf_id\r\n\tINNER JOIN \r\n\t\t(SELECT\r\n\t\t\twf_detail_approval_level,\r\n\t\t\tcategoly_wf_status_id,\r\n\t\t\tLEAD(categoly_wf_status_id, 1) OVER (PARTITION BY wf_id ORDER BY wf_detail_approval_level ASC) AS categoly_wf_status_id_next,\r\n\t\t\tLEAD(wf_detail_id, 1) OVER (PARTITION BY wf_id ORDER BY wf_detail_approval_level ASC) AS wf_detail_id_next,\r\n\t\t\tLEAD(wf_detail_approval_update_employee_z_code, 1) OVER (PARTITION BY wf_id ORDER BY wf_detail_approval_level ASC) AS wf_detail_approval_update_employee_z_code_next,\r\n\t\t\twf_id\r\n\t\tFROM edm_wf_details) AS wf_detail\r\n\t\tON wf.wf_id = wf_detail.wf_id\r\n\tINNER JOIN\r\n\t\t(SELECT\r\n\t\t\twf_id,\r\n\t\t\tMAX(wf_detail_approval_level) AS wf_detail_approval_level\r\n\t\tFROM\r\n\t\t\tdbo.edm_wf_details\r\n\t\tWHERE categoly_wf_status_id > 0\r\n\t\tGROUP BY wf_id) AS wf_detail_max\r\n\t\tON wf_detail.wf_id = wf_detail_max.wf_id AND wf_detail.wf_detail_approval_level = wf_detail_max.wf_detail_approval_level\r\n\tWHERE categoly_wf_status_id > 0\r\n)\r\n\r\nSELECT\r\n\texperiment_document.experiment_document_id,\r\n\texperiment_document.experiment_document_name,\r\n\texperiment_document_relation.categoly_experiment_document_relation_id,\r\n\t\tCASE\r\n\t\tWHEN progress.categoly_wf_id = 3 THEN 6\r\n\t\tWHEN progress.categoly_wf_id = 2 AND progress.categoly_wf_status_id_next IS NULL THEN 5\r\n\t\tWHEN progress.categoly_wf_id = 2 AND progress.categoly_wf_status_id_next = 0 THEN 4\r\n\t\tWHEN progress.categoly_wf_id = 1 AND progress.categoly_wf_status_id_next IS NULL THEN 3\r\n\t\tWHEN progress.categoly_wf_id = 1 AND progress.categoly_wf_status_id_next = 0 THEN 2\r\n\t\tELSE 1 \r\n\tEND AS progress_id\r\nFROM\r\n\tedm_experiment_documents AS experiment_document\r\nINNER JOIN\r\n\tedm_experiment_document_relations AS experiment_document_relation\r\n\tON experiment_document.experiment_document_id = experiment_document_relation.experiment_document_id\r\nLEFT OUTER JOIN\r\n\tprogress\r\n\tON experiment_document.experiment_document_id = progress.experiment_document_id","SourceTableName":"edm_view_experiment_document_relations","SourceTableSchema":"dbo","DataBaseType":1,"ViewInfo":{"ViewName":"edm_view_experiment_document_relations","IsUpdatable":true,"QueryColumns":["experiment_document_id"]},"UserSetQueryColumns":["experiment_document_id"]},"Name":"edm_view_experiment_document_relations","Relations":[]}