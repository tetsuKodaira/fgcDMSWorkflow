{"Columns":[{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"varchar","MaxLength":-1,"Name":"experiment_document_id_order","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"char","MaxLength":-1,"Name":"experiment_document_id","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"experiment_document_name","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"organization_name","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"theme_name","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"plan_purpose","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"plan_hypothesis","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"record_conclusion","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"int","MaxLength":-1,"Name":"organization_code","ColumnType":"System.Int32, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"organization_name_short","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"int","MaxLength":-1,"Name":"dept_code","ColumnType":"System.Int32, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"dept_name","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"varchar","MaxLength":-1,"Name":"employee_name","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"employee_z_code","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"update_date","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"varchar","MaxLength":-1,"Name":"progress_name","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"int","MaxLength":-1,"Name":"progress_id","ColumnType":"System.Int32, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"int","MaxLength":-1,"Name":"categoly_wf_id","ColumnType":"System.Int32, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"int","MaxLength":-1,"Name":"categoly_wf_status_id","ColumnType":"System.Int32, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"wf_detail_approval_update_employee_z_code_next","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"bigint","MaxLength":-1,"Name":"wf_id","ColumnType":"System.Int64, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"int","MaxLength":-1,"Name":"wf_detail_id_next","ColumnType":"System.Int32, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"int","MaxLength":-1,"Name":"categoly_wf_status_id_next","ColumnType":"System.Int32, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"int","MaxLength":-1,"Name":"theme_id","ColumnType":"System.Int32, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"plan_verification_method","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"plan_file","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"plan_ky","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"experiment_document_note","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"analytical_test_id","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"analytical_test_url","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"project_id","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"dms_relation_url","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"record_conclusion_free","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"record_file","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"record_action","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"int","MaxLength":-1,"Name":"categoly_conclusion_id","ColumnType":"System.Int32, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"record_result","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"decimal","MaxLength":-1,"Name":"record_working_hour_figure","ColumnType":"System.Decimal, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"varchar","MaxLength":-1,"Name":"create_financial_year","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"}],"ExternalDatabaseInfo":{"SourceConnectString":"Data Source=ntvmd396;Initial Catalog=ExperimentDocumentManagementTest;Persist Security Info=True;User ID=z037674;Password=z037674","CreateViewSql":"WITH experiment_document AS(\r\n\tSELECT\r\n\t\texperiment_document.experiment_document_id,\r\n\t\texperiment_document.experiment_document_create_employee_z_code AS create_employee_z_code,\r\n\t\tFORMAT(ISNULL(record.record_update_datetime, planning.plan_update_datetime), 'yyyy/MM/dd') AS update_date, \r\n        experiment_document.experiment_document_name,\r\n\t\texperiment_document.organization_code,\r\n\t\texperiment_document.theme_id,\r\n\t\tplanning.plan_purpose,\r\n\t\tplanning.plan_hypothesis,\r\n\t\tISNULL(categoly_conclusion.categoly_conclusion_name, record.record_conclusion) AS record_conclusion,\r\n\t\tplanning.plan_verification_method,\r\n\t\tplanning.plan_file,\r\n\t\tplanning.plan_ky,\r\n\t\texperiment_document.experiment_document_note,\r\n\t\trequest_analytical_test.analytical_test_id,\r\n\t\trequest_analytical_test.analytical_test_url,\r\n\t\tdms_relation.project_id,\r\n\t\tdms_relation.dms_relation_url,\r\n\t\trecord.record_conclusion AS record_conclusion_free,\r\n\t\trecord.record_file,\r\n\t\trecord.record_action,\r\n\t\trecord.categoly_conclusion_id,\r\n\t\trecord.record_result,\r\n\t\trecord.record_working_hour_figure,\r\n\t\tSUBSTRING(experiment_document.experiment_document_id,10,4) AS create_financial_year\r\n\tFROM\r\n\t\tdbo.edm_experiment_documents AS experiment_document\r\n\tINNER JOIN\r\n\t\tdbo.edm_plans AS planning\r\n\t\tON experiment_document.experiment_document_id = planning.experiment_document_id\r\n\tLEFT OUTER JOIN\r\n\t\tdbo.edm_records AS record\r\n\t\tON planning.experiment_document_id = record.experiment_document_id\r\n\tLEFT OUTER JOIN\r\n\t\tdbo.edm_categoly_conclusions AS categoly_conclusion\r\n\t\tON record.categoly_conclusion_id = categoly_conclusion.categoly_conclusion_id\r\n\tLEFT OUTER JOIN\r\n\t\tedm_request_analytical_tests AS request_analytical_test\r\n\t\tON experiment_document.experiment_document_id = request_analytical_test.experiment_document_id\r\n\tLEFT OUTER JOIN\r\n\t\tedm_dms_relations AS dms_relation\r\n\t\tON experiment_document.experiment_document_id = dms_relation.experiment_document_id\r\n), \r\n--WFテーブルから最新進捗を取得\r\nprogress AS(\r\n\tSELECT\r\n\t\twf.experiment_document_id,\r\n\t\twf.categoly_wf_id,\r\n\t\twf_detail.wf_detail_approval_level,\r\n\t\twf_detail.categoly_wf_status_id,\r\n\t\twf_detail.wf_detail_approval_update_employee_z_code_next,\r\n\t\twf.wf_id,\r\n\t\twf_detail.wf_detail_id_next,\r\n\t\twf_detail.categoly_wf_status_id_next\r\n\tFROM \r\n\t\tdbo.edm_wfs AS wf\r\n\tINNER JOIN\r\n\t\t(SELECT\r\n\t\t\texperiment_document_id,\r\n\t\t\tMAX(categoly_wf_id) AS categoly_wf_id\r\n        FROM dbo.edm_wfs\r\n        GROUP BY experiment_document_id) AS wf_max\r\n\t\tON wf.experiment_document_id = wf_max.experiment_document_id AND wf.categoly_wf_id = wf_max.categoly_wf_id\r\n\tINNER JOIN \r\n\t\t(SELECT\r\n\t\t\twf_detail_approval_level,\r\n\t\t\tcategoly_wf_status_id,\r\n\t\t\tLEAD(categoly_wf_status_id, 1) OVER (PARTITION BY wf_id ORDER BY wf_detail_approval_level ASC) AS categoly_wf_status_id_next,\r\n\t\t\tLEAD(wf_detail_id, 1) OVER (PARTITION BY wf_id ORDER BY wf_detail_approval_level ASC) AS wf_detail_id_next,\r\n\t\t\tLEAD(wf_detail_approval_update_employee_z_code, 1) OVER (PARTITION BY wf_id ORDER BY wf_detail_approval_level ASC) AS wf_detail_approval_update_employee_z_code_next,\r\n\t\t\twf_id\r\n\t\tFROM edm_wf_details) AS wf_detail\r\n\t\tON wf.wf_id = wf_detail.wf_id\r\n\tINNER JOIN\r\n\t\t(SELECT\r\n\t\t\twf_id,\r\n\t\t\tMAX(wf_detail_approval_level) AS wf_detail_approval_level\r\n\t\tFROM\r\n\t\t\tdbo.edm_wf_details\r\n\t\tWHERE categoly_wf_status_id > 0\r\n\t\tGROUP BY wf_id) AS wf_detail_max\r\n\t\tON wf_detail.wf_id = wf_detail_max.wf_id AND wf_detail.wf_detail_approval_level = wf_detail_max.wf_detail_approval_level\r\n\tWHERE categoly_wf_status_id > 0\r\n)\r\nSELECT TOP 100 PERCENT\r\n\tCASE WHEN\r\n\t\tLEN(experiment_document.experiment_document_id) = 10 THEN RIGHT(experiment_document.experiment_document_id, 10)\r\n\t\tELSE experiment_document.experiment_document_id\r\n\tEND AS experiment_document_id_order,\r\n\texperiment_document.experiment_document_id,\r\n\texperiment_document.experiment_document_name,\r\n\tdepartment.organization_name,\r\n\tISNULL(theme.theme_name, '研究テーマ無し') AS theme_name, \r\n\texperiment_document.plan_purpose,\r\n\texperiment_document.plan_hypothesis,\r\n\texperiment_document.record_conclusion,\r\n\texperiment_document.organization_code,\r\n\tdepartment.organization_name AS organization_name_short,\r\n\tdepartment.dept_code,\r\n\tdepartment.dept_name,\r\n\temployee_list.account_display_name AS employee_name,\r\n\temployee_list.account_code AS employee_z_code,\r\n\texperiment_document.update_date, \r\n\tCASE\r\n\t\tWHEN progress.categoly_wf_id = 3 THEN '中止'\r\n\t\tWHEN progress.categoly_wf_id = 2 AND progress.categoly_wf_status_id_next IS NULL THEN '完了'\r\n\t\tWHEN progress.categoly_wf_id = 2 AND progress.categoly_wf_status_id_next = 0 THEN '記録承認中'\r\n\t\tWHEN progress.categoly_wf_id = 1 AND progress.categoly_wf_status_id_next IS NULL THEN '実験中'\r\n\t\tWHEN progress.categoly_wf_id = 1 AND progress.categoly_wf_status_id_next = 0 THEN '計画承認中'\r\n\t\tELSE '計画作成中'\r\n\tEND AS progress_name,\r\n\tCASE\r\n\t\tWHEN progress.categoly_wf_id = 3 THEN 6\r\n\t\tWHEN progress.categoly_wf_id = 2 AND progress.categoly_wf_status_id_next IS NULL THEN 5\r\n\t\tWHEN progress.categoly_wf_id = 2 AND progress.categoly_wf_status_id_next = 0 THEN 4\r\n\t\tWHEN progress.categoly_wf_id = 1 AND progress.categoly_wf_status_id_next IS NULL THEN 3\r\n\t\tWHEN progress.categoly_wf_id = 1 AND progress.categoly_wf_status_id_next = 0 THEN 2\r\n\t\tELSE 1 \r\n\tEND AS progress_id,\r\n\tISNULL(progress.categoly_wf_id, 0) AS categoly_wf_id,\r\n\tISNULL(progress.categoly_wf_status_id, 0) AS categoly_wf_status_id,\r\n\tprogress.wf_detail_approval_update_employee_z_code_next,\r\n\tprogress.wf_id,\r\n\tprogress.wf_detail_id_next,\r\n\tprogress.categoly_wf_status_id_next,\r\n\texperiment_document.theme_id,\r\n\texperiment_document.plan_verification_method,\r\n\texperiment_document.plan_file,\r\n\texperiment_document.plan_ky,\r\n\texperiment_document.experiment_document_note,\r\n\texperiment_document.analytical_test_id,\r\n\texperiment_document.analytical_test_url,\r\n\texperiment_document.project_id,\r\n\texperiment_document.dms_relation_url,\r\n\trecord_conclusion_free,\r\n\trecord_file,\r\n\trecord_action,\r\n\tcategoly_conclusion_id,\r\n\trecord_result,\r\n\trecord_working_hour_figure,\r\n\tcreate_financial_year\r\nFROM\r\n\texperiment_document\r\nLEFT OUTER JOIN\r\n\tAccessPermissionManagement.dbo.apm_dept_organization_relations AS department\r\n\tON experiment_document.organization_code = department.organization_code\r\n--テーマ情報がない場合も存在するため、左外部結合\r\nLEFT OUTER JOIN\r\n\tResearchThemeManagement.dbo.rtm_themes AS theme\r\n\tON experiment_document.theme_id = theme.theme_id\r\nLEFT OUTER JOIN\r\n\tAccessPermissionManagement.dbo.apm_nac_acc_account AS employee_list\r\n\tON experiment_document.create_employee_z_code = employee_list.account_code\r\n--ワークフロー履歴がない場合が存在するため左外部結合\r\nLEFT OUTER JOIN\r\n    (SELECT\r\n\t\texperiment_document_id,\r\n\t\tcategoly_wf_id,\r\n\t\twf_detail_approval_level,\r\n\t\tcategoly_wf_status_id,\r\n\t\twf_detail_approval_update_employee_z_code_next,\r\n\t\twf_id,\r\n\t\tcategoly_wf_status_id_next,\r\n\t\twf_detail_id_next\r\n    FROM progress) AS progress\r\n\tON experiment_document.experiment_document_id = progress.experiment_document_id\r\n--ワークフロー履歴がない場合が存在するため左外部結合\r\nLEFT OUTER JOIN\r\n\tdbo.edm_categoly_wfs AS categoly_wf\r\n\tON progress.categoly_wf_id = categoly_wf.categoly_wf_id\r\nORDER BY update_date DESC\r\n","SourceTableName":"edm_view_experiment_documents","SourceTableSchema":"dbo","DataBaseType":1,"ViewInfo":{"ViewName":"edm_view_experiment_documents","IsUpdatable":true,"QueryColumns":["experiment_document_id"]},"UserSetQueryColumns":["experiment_document_id"]},"Name":"edm_view_experiment_documents","Relations":[]}