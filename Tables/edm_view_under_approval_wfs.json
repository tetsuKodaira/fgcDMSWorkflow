{"Columns":[{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"char","MaxLength":-1,"Name":"experiment_document_id","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"experiment_document_name","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"int","MaxLength":-1,"Name":"categoly_wf_id","ColumnType":"System.Int32, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"categoly_wf_name","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"int","MaxLength":-1,"Name":"categoly_wf_status_id","ColumnType":"System.Int32, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"categoly_wf_status_name","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"wf_detail_approval_update_employee_z_code_applicant","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"wf_detail_approval_update_employee_z_code","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"wf_detail_approval_update_employee_z_code_next","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","Required":true,"DatabaseColumnType":"bigint","MaxLength":-1,"Name":"wf_id","ColumnType":"System.Int64, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"wf_detail_approval_update_date","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"varchar","MaxLength":-1,"Name":"employee_name","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"varchar","MaxLength":-1,"Name":"employee_name_applicant","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"},{"$type":"Forguncy.Model.Tables.BindingColumn, ServerDesignerCommon","DatabaseColumnType":"nvarchar","MaxLength":-1,"Name":"wf_detail_comment","ColumnType":"System.String, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"}],"ExternalDatabaseInfo":{"SourceConnectString":"Data Source=ntvmd396;Initial Catalog=ExperimentDocumentManagementTest;Persist Security Info=True;User ID=z037674;Password=z037674","CreateViewSql":"WITH progress AS(\r\n\tSELECT\r\n\t\twf.experiment_document_id,\r\n\t\twf.categoly_wf_id,\r\n\t\twf_detail.wf_detail_approval_level,\r\n\t\twf_detail.categoly_wf_status_id,\r\n\t\twf_detail_applicant.wf_detail_approval_update_employee_z_code AS wf_detail_approval_update_employee_z_code_applicant,\r\n\t\twf_detail.wf_detail_approval_update_employee_z_code, \r\n\t\twf_detail.wf_detail_approval_update_employee_z_code_next,\r\n\t\twf.wf_id,\r\n\t\twf_detail.categoly_wf_status_id_next,\r\n\t\twf_detail_approval_update_date,\r\n\t\twf_detail_comment\r\n\tFROM\r\n\t\tdbo.edm_wfs AS wf\r\n\t\t/*記録書毎にcategoly_wf_idの最大値を取得*/\r\n\tINNER JOIN\r\n\t\t(SELECT\r\n\t\t\texperiment_document_id,\r\n\t\t\tMAX(categoly_wf_id) AS categoly_wf_id\r\n\t\tFROM\r\n\t\t\tdbo.edm_wfs\r\n\t\tGROUP BY experiment_document_id) AS wf_max\r\n\t\tON wf.experiment_document_id = wf_max.experiment_document_id AND wf.categoly_wf_id = wf_max.categoly_wf_id\r\n\tINNER JOIN\r\n\t\t(SELECT\r\n\t\t\twf_detail_approval_update_date,\r\n\t\t\twf_detail_approval_update_employee_z_code,\r\n\t\t\twf_detail_approval_level, categoly_wf_status_id,\r\n\t\t\twf_detail_comment,\r\n\t\t\tLEAD(categoly_wf_status_id, 1) OVER (PARTITION BY wf_id ORDER BY wf_detail_approval_level ASC) AS categoly_wf_status_id_next,\r\n\t\t\tLEAD(wf_detail_id, 1) OVER (PARTITION BY wf_id ORDER BY wf_detail_approval_level ASC) AS wf_detail_id_next,\r\n\t\t\tLEAD(wf_detail_approval_update_employee_z_code, 1) OVER (PARTITION BY wf_id ORDER BY wf_detail_approval_level ASC) AS wf_detail_approval_update_employee_z_code_next,\r\n\t\t\twf_id\r\n\t\tFROM\r\n\t\t\tedm_wf_details) AS wf_detail\r\n\t\t\tON wf.wf_id = wf_detail.wf_id\r\n\tINNER JOIN\r\n\t\t(SELECT\r\n\t\t\twf_id,\r\n\t\t\tMAX(wf_detail_approval_level) AS wf_detail_approval_level\r\n\t\tFROM\r\n\t\t\tdbo.edm_wf_details\r\n\t\tWHERE categoly_wf_status_id > 0\r\n\t\tGROUP BY wf_id) AS wf_detail_max\r\n\t\tON wf_detail.wf_id = wf_detail_max.wf_id AND wf_detail.wf_detail_approval_level = wf_detail_max.wf_detail_approval_level\r\n\tINNER JOIN\r\n\t\t(SELECT\r\n\t\t\twf_id,\r\n\t\t\twf_detail_approval_update_employee_z_code\r\n\t\tFROM\r\n\t\t\tedm_wf_details\r\n\t\tWHERE wf_detail_approval_level = 1) AS wf_detail_applicant\r\n\t\tON wf.wf_id = wf_detail_applicant.wf_id\r\n\t\tWHERE categoly_wf_status_id > 0\r\n)\r\nSELECT\r\n\texperiment_document.experiment_document_id,\r\n\texperiment_document.experiment_document_name,\r\n\tcategoly_wf.categoly_wf_id,\r\n\tCASE\r\n\t\tWHEN progress.categoly_wf_status_id = 3 AND progress.categoly_wf_id = 1 THEN '計画再申請'\r\n\t\tWHEN progress.categoly_wf_status_id = 3 AND progress.categoly_wf_id = 2 THEN '記録再申請'\r\n\t\tELSE categoly_wf.categoly_wf_name\r\n\tEND AS categoly_wf_name,\r\n\tcategoly_wf_status.categoly_wf_status_id,\r\n\tcategoly_wf_status.categoly_wf_status_name,\r\n\tprogress.wf_detail_approval_update_employee_z_code_applicant,\r\n\tprogress.wf_detail_approval_update_employee_z_code, \r\n\tprogress.wf_detail_approval_update_employee_z_code_next,\r\n\tprogress.wf_id,\r\n\tFORMAT(progress.wf_detail_approval_update_date, 'yyyy/MM/dd') AS wf_detail_approval_update_date,\r\n\temployee_approval_update.account_display_name AS employee_name,\r\n\temployee_approval_update_applicant.account_display_name AS employee_name_applicant,\r\n\tprogress.wf_detail_comment\r\nFROM\r\n\tprogress\r\nINNER JOIN\r\n\tedm_experiment_documents AS experiment_document\r\n\tON progress.experiment_document_id = experiment_document.experiment_document_id\r\nINNER JOIN\r\n\tedm_categoly_wfs AS categoly_wf\r\n\tON progress.categoly_wf_id = categoly_wf.categoly_wf_id\r\nINNER JOIN\r\n\tedm_categoly_wf_statuses AS categoly_wf_status\r\n\tON progress.categoly_wf_status_id = categoly_wf_status.categoly_wf_status_id\r\nINNER JOIN\r\n\tAccessPermissionManagement.dbo.apm_nac_acc_account AS employee_approval_update\r\n\tON progress.wf_detail_approval_update_employee_z_code = employee_approval_update.account_code\r\nINNER JOIN\r\n\tAccessPermissionManagement.dbo.apm_nac_acc_account AS employee_approval_update_applicant\r\n\tON progress.wf_detail_approval_update_employee_z_code_applicant = employee_approval_update_applicant.account_code","SourceTableName":"edm_view_under_approval_wfs","SourceTableSchema":"dbo","DataBaseType":1,"ViewInfo":{"ViewName":"edm_view_under_approval_wfs","IsUpdatable":true,"QueryColumns":["experiment_document_id"]},"UserSetQueryColumns":["experiment_document_id"]},"Name":"edm_view_under_approval_wfs","Relations":[]}